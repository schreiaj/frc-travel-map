<!DOCTYPE html>
<html>
<meta charset="utf-8">
<style>

/* CSS goes here. */

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>

/* JavaScript goes here. */
var width = 1000,
    height = 800;

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);
var list = d3.select("body").append("ul").classed("list", true)

var renderedEvents = []

var mercator = d3.geo.mercator()
  .scale((width + 1) / 2 / Math.PI)
  .translate([width / 2, height / 2])
  .precision(.1);

d3.json("countries.geo.json", function(error, world) {
  svg.selectAll("path")
    .data(world.features)
    .enter()
    .append("path")
    .attr("d", d3.geo.path().projection(mercator));
});

var path = d3.geo.path()
  .projection(mercator)

function loadEvent(eventCode){

  d3.json(eventCode+".json", function(error, event){
    console.log("Loading " + eventCode);
    console.log(event.length);
    links = []
    event.forEach(function(e){
      links.push({
        type: "LineString",
        coordinates: [
          e.team_location.coordinates,
          e.event_location.coordinates
        ]
      })
    })

    g = svg.append("g")
    pathArcs = g.selectAll(".arc")
      .data(links)

    pathArcs.enter()
      .append("path")
      .attr("d", path)
      .attr("id", function(d){return d.team})
      .classed("arc", true)
      .classed("frc"+eventCode, true)
      // .on("mouseover", function(d){return select("#"+d.team)})
      // .on("mouseout", function(d){return deselect(d)})
    renderedEvents.push(eventCode)
    updateRenderedEvents();
    console.log("Done");
  })

}

events = ["2014abca",
  "2014arc",
  "2014arfa",
  "2014azch",
  "2014calb",
  "2014cama",
  "2014casa",
  "2014casb",
  "2014casd",
  "2014casj",
  "2014cmp",
  "2014code",
  "2014ctgro",
  "2014cthar",
  "2014ctsou",
  "2014cur",
  "2014dcwa",
  "2014flfo",
  "2014flor",
  "2014gadu",
  "2014gal",
  "2014hiho",
  "2014ilch",
  "2014ilil",
  "2014inth",
  "2014inwl",
  "2014ista",
  "2014lake",
  "2014mabos",
  "2014mawor",
  "2014mdba",
  "2014melew",
  "2014mibed",
  "2014micen",
  "2014micmp",
  "2014miesc",
  "2014migul",
  "2014mihow",
  "2014miket",
  "2014milan",
  "2014miliv",
  "2014mimid",
  "2014misjo",
  "2014misou",
  "2014mitry",
  "2014mitvc",
  "2014miwat",
  "2014miwmi",
  "2014mndu",
  "2014mndu2",
  "2014mnmi",
  "2014mnmi2",
  "2014mokc",
  "2014mosl",
  "2014mrcmp",
  "2014mxmc",
  "2014ncre",
  "2014necmp",
  "2014new",
  "2014nhdur",
  "2014nhnas",
  "2014njbri",
  "2014njcli",
  "2014njfla",
  "2014njtab",
  "2014nvlv",
  "2014nyli",
  "2014nyny",
  "2014nyro",
  "2014nytr",
  "2014ohci",
  "2014ohcl",
  "2014okok",
  "2014onnb",
  "2014onto",
  "2014onto2",
  "2014onwa",
  "2014onwi",
  "2014orore",
  "2014orosu",
  "2014orwil",
  "2014pahat",
  "2014paphi",
  "2014papi",
  "2014pncmp",
  "2014qcmo",
  "2014rismi",
  "2014scmb",
  "2014tnkn",
  "2014txda",
  "2014txho",
  "2014txlu",
  "2014txsa",
  "2014utwv",
  "2014vari",
  "2014waahs",
  "2014waamv",
  "2014wache",
  "2014waell",
  "2014wamou",
  "2014washo",
  "2014wasno",
  "2014wimi"]

events.forEach(loadEvent)

function select(code){
  svg.selectAll(code).classed("active", true)
}

function deselect(code){
  svg.selectAll(".active").classed("active", false)
}


function updateRenderedEvents(){
  list.selectAll("li")
    .data(renderedEvents)
    .enter()
    .append("li")
    .text(function(d){return d})
    .on("mouseover", function(d){return select(".frc"+d)})
    .on("mouseout", function(d){return deselect(d)})
}
</script>
<style media="screen">
  path{
    fill:none;
    stroke: gray;
    stroke-width: 1.2;
  }

  .arc{
    stroke-opacity: 0.2;
    stroke: gray;
    stroke-width: 0.5;
  }

  .active{
    stroke-opacity: 0.6;
    stroke: red;
    stroke-width: 0.75;
  }

  .list{
    /*font-size: 12px;*/
    position: absolute;
    left: 1000px;
    top: 0px;
    height: 800px;
    overflow: scroll;
    width: 200px;
    cursor: pointer;
  }

  .list li{
    padding-top:5px;
  }
}
</style>
</body>
</html>
